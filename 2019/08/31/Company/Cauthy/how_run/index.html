<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    

    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?cb4be66237379541488b8502a6eca006"></script>
<!-- End Baidu Tongji -->




    <meta charset="utf-8">
    
    
    
    
    <title>框架运行docker设计 | 大地小神 | 你们都是大傻瓜, 我是天下大赢家</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Cauchy">
    <meta name="description" content="dummy          code{white-space: pre-wrap;}       span.smallcaps{font-variant: small-caps;}       span.underline{text-decoration: underline;}       div.column{display: inline-block; vert">
<meta name="keywords" content="Cauchy">
<meta property="og:type" content="article">
<meta property="og:title" content="框架运行docker设计">
<meta property="og:url" content="https://qrsforever.github.io/2019/08/31/Company/Cauthy/how_run/index.html">
<meta property="og:site_name" content="大地小神">
<meta property="og:description" content="dummy          code{white-space: pre-wrap;}       span.smallcaps{font-variant: small-caps;}       span.underline{text-decoration: underline;}       div.column{display: inline-block; vert">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-09-16T12:56:11.909Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="框架运行docker设计">
<meta name="twitter:description" content="dummy          code{white-space: pre-wrap;}       span.smallcaps{font-variant: small-caps;}       span.underline{text-decoration: underline;}       div.column{display: inline-block; vert">
    
        <link rel="alternate" type="application/atom+xml" title="大地小神" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">qrsforever</h5>
          <a href="mailto:985612771@qq.com" title="985612771@qq.com" class="mail">985612771@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/qrsforever" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://gitee.com/lidongai" target="_blank" >
                <i class="icon icon-lg icon-code-fork"></i>
                Gitee
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://weibo.com/705723886/" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://twitter.com/qrsforever" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/2017/08/30/CV"  >
                <i class="icon icon-lg icon-user-circle"></i>
                Author
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">框架运行docker设计</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">框架运行docker设计</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-08-31T05:53:32.000Z" itemprop="datePublished" class="page-time">
  2019-08-31
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Company/">Company</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#如何启动框架"><span class="post-toc-text">1 如何启动框架</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#三层镜像"><span class="post-toc-text">2 三层镜像</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#制作镜像"><span class="post-toc-text">3 制作镜像</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#制作第二层"><span class="post-toc-text">3.1 制作第二层</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#制作第三层"><span class="post-toc-text">3.2 制作第三层</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#简单总结"><span class="post-toc-text">4 简单总结</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#补充"><span class="post-toc-text">5 补充</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#附件"><span class="post-toc-text">6 附件:</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Company/Cauthy/how_run"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">框架运行docker设计</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-08-31 13:53:32" datetime="2019-08-31T05:53:32.000Z"  itemprop="datePublished">2019-08-31</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Company/">Company</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>dummy</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
  </style>
  <link rel="stylesheet" href="/css/pandoc.css">
</head>
<body>
<!-- vim-markdown-toc GFM -->
<ul>
<li><a href="#如何启动框架">如何启动框架</a></li>
<li><a href="#三层镜像">三层镜像</a></li>
<li><a href="#制作镜像">制作镜像</a>
<ul>
<li><a href="#制作第二层">制作第二层</a></li>
<li><a href="#制作第三层">制作第三层</a></li>
</ul></li>
<li><a href="#简单总结">简单总结</a></li>
<li><a href="#补充">补充</a></li>
</ul>
<!-- vim-markdown-toc -->
<a id="more"></a>
<h1 id="如何启动框架"><span class="header-section-number">1</span> 如何启动框架</h1>
<p>框架的部署使用docker, docker依赖镜像, 从缩短部署时间和减少带宽浪费的角度设计, 我们的框架使用三层镜像, 未来 框架足够稳定, 可以做一个完整的镜像"pull"镜像服务器上, 先介绍三层镜像构建和启动.</p>
<p>在介绍之前先把常用的docker命令做个Alias, 后面一些例子会用到.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="bu">alias</span> di=<span class="st">&#39;docker images&#39;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="bu">alias</span> dri=<span class="st">&#39;docker rmi&#39;</span> <span class="co"># $(docker images -q)&#39;</span></a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="bu">alias</span> dc=<span class="st">&#39;docker container ls -a&#39;</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="bu">alias</span> drc=<span class="st">&#39;docker container rm&#39;</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="bu">alias</span> dsc=<span class="st">&#39;docker container stop&#39;</span></a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="bu">alias</span> dv=<span class="st">&#39;docker volume ls&#39;</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="bu">alias</span> drv=<span class="st">&#39;docker volume rm&#39;</span></a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="bu">alias</span> dip=<span class="st">&#39;docker inspect --format=&quot;\{\{range .NetworkSettings.Networks\}\}\{\{.IPAddress\}\}\{\{end\}\}&quot;&#39;</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="bu">alias</span> dit=<span class="st">&#39;docker run -it&#39;</span></a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="bu">alias</span> din=<span class="st">&#39;docker inspect&#39;</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="bu">alias</span> dlg=<span class="st">&#39;docker logs --follow&#39;</span></a>
<a class="sourceLine" id="cb1-16" title="16"></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="fu">dsh()</span></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="kw">{</span></a>
<a class="sourceLine" id="cb1-19" title="19">    <span class="va">args=($@)</span></a>
<a class="sourceLine" id="cb1-20" title="20">    <span class="va">container=$1</span></a>
<a class="sourceLine" id="cb1-21" title="21">    <span class="va">bashcmd=${args[@]: 1:$# }</span></a>
<a class="sourceLine" id="cb1-22" title="22">    <span class="ex">docker</span> exec <span class="va">$container</span> bash -c <span class="st">&quot;</span><span class="va">$bashcmd</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb1-23" title="23"><span class="kw">}</span></a></code></pre></div>
<h1 id="三层镜像"><span class="header-section-number">2</span> 三层镜像</h1>
<p>cmd: <code>colorai@10-255-0-185:~$ di</code></p>
<p>output:</p>
<pre><code>   第三层: 咱们框架自身,排除三方库, 可以认为就是框架代码自身安装, 可能更新会频繁.
                             ^
                             |
                             |
REPOSITORY                   |  TAG                 IMAGE ID            CREATED             SIZE
colorai/cauchycv_visdom |    |  0.2.7               5d3ab89af6d4        15 hours ago        6.3GB
colorai/cauchycv_visdom |----+  0.2.6               98a757ed7816        16 hours ago        6.3GB
colorai/cauchycv_visdom |       0.2.5               7148c78368fb        20 hours ago        6.3GB
colorai/cauchycv_base           latest              83c5742fc484        22 hours ago        6.06GB
ufoym/deepo    |                pytorch-py36-cu90   242fdb23e0b0        5 months ago        4.53GB
    |          |
    |          +-----&gt;  第二层: 框架运行时依赖的第三方软件和必要工具, 基于第一层又加了不少, 更新不频繁
    |
    |
    +---&gt; 第一层: 包含机器学习框架pytorch需要必要软件工具, 几乎不更新
</code></pre>
<p>有了第二层(本地镜像)的出现, 在更新第三层时, 就会少很多三方软件的安装, 节省时间和带宽.</p>
<h1 id="制作镜像"><span class="header-section-number">3</span> 制作镜像</h1>
<p>先介绍一下, 版本信息的设计和存储方案, 为以后定位问题提供帮助.</p>
<p><a href="https://gitee.com/colorai/sig_cauchy_cv" target="_blank" rel="noopener">CauchyCV框架代码</a>使用git管理, 所以很多信息是从git命令中获取.</p>
<p>例如: <code>build_docker.sh</code>中的部分代码:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="va">DATE=$(</span><span class="fu">date</span> -u +<span class="st">&#39;%Y-%m-%dT%H:%M:%SZ&#39;</span><span class="va">)</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="va">VERSION=$(</span><span class="fu">git</span> describe --tags --always<span class="va">)</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="va">URL=$(</span><span class="fu">git</span> config --get remote.origin.url<span class="va">)</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="va">COMMIT=$(</span><span class="fu">git</span> rev-parse HEAD <span class="kw">|</span> <span class="fu">cut</span> -c 1-7<span class="va">)</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="va">BRANCH=$(</span><span class="fu">git</span> rev-parse --abbrev-ref HEAD<span class="va">)</span></a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="va">TAG=</span><span class="st">&quot;0.2.</span><span class="va">$(</span><span class="fu">git</span> rev-list HEAD <span class="kw">|</span> <span class="fu">wc</span> -l <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1}&#39;</span><span class="va">)</span><span class="st">&quot;</span></a></code></pre></div>
<p>分别提取出: 当前时间, 版本, 代码URL, 最后一次提交commit-id, 以及分支号, 还有TAG作为镜像的版本, 如<code>0.2.7</code>, 其中后面的7是代码所有提交的总个数, 是一个递增的数字. 所有这些变量会在build docker时传入到镜像的labels中.</p>
<h2 id="制作第二层"><span class="header-section-number">3.1</span> 制作第二层</h2>
<p>比较简单, 基于第一层<strong>ufoym/deepo</strong>, 然后<code>apt install</code> 和 <code>pip install</code>安装框架需要的软件, 同时也安装咱们自 己维护的<a href="https://gitee.com/colorai/sig_cauchy_external" target="_blank" rel="noopener">外部库</a>, 这些外部库因为github上更新较为频繁, 对我 们调试开发会带来不可知的影响, 所以单独管理起来, 其中还包括<code>vulcan</code>.</p>
<p>提供了一个<code>DockerFile.base</code>文件, 构建第二层镜像直接指定这个文件即可, 不要忘了外部库要提前下载.</p>
<p>例如: <code>build_docker.sh</code>中的部分代码:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="va">base_image=</span>colorai/cauchycv_base</a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">if</span><span class="bu"> [</span> <span class="ot">!</span> <span class="ot">-d</span> external<span class="bu"> ]</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="kw">then</span></a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="fu">git</span> clone git@gitee.com:colorai/sig_cauchy_external.git external</a>
<a class="sourceLine" id="cb4-6" title="6"><span class="kw">fi</span></a>
<a class="sourceLine" id="cb4-7" title="7"></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="va">base_tag=</span><span class="kw">`</span><span class="ex">docker</span> images -q <span class="va">$base_image</span>:latest<span class="kw">`</span></a>
<a class="sourceLine" id="cb4-9" title="9"></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="kw">if [[</span> x<span class="va">$base_tag</span> <span class="ot">==</span> x<span class="kw"> ]]</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="kw">then</span></a>
<a class="sourceLine" id="cb4-12" title="12">     <span class="bu">echo</span> <span class="st">&quot;build </span><span class="va">$base_image</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb4-13" title="13">     <span class="ex">docker</span> build --tag <span class="va">$base_image</span>:latest \</a>
<a class="sourceLine" id="cb4-14" title="14">                  --build-arg DATE=<span class="va">$DATE</span> \</a>
<a class="sourceLine" id="cb4-15" title="15">                  --file Dockerfile.base .</a>
<a class="sourceLine" id="cb4-16" title="16"><span class="kw">fi</span></a></code></pre></div>
<p>值得注意的是Base镜像指定的TAG版本固定为"latest", 即本地只会(或者要保证)有一个.</p>
<p>详细信息可查看<a href="https://gitee.com/colorai/sig_cauchy_cv/blob/master/Dockerfile.base" target="_blank" rel="noopener">DockerFile.base</a></p>
<h2 id="制作第三层"><span class="header-section-number">3.2</span> 制作第三层</h2>
<p>框架层镜像一个重点就是描述好本镜像自身, 然后安装框架到镜像中即可, 如何把上面提到的版本信息保存在镜像中?</p>
<p>Docker提供LABEL命令, 可以实现该功能, 先看看下面的实例(Dockerfile部分代码):</p>
<pre class="shell"><code>LABEL maintainer=&quot;colorai@colorai.com&quot;

ARG VENDOR=&quot;ColorAI&quot;
ARG REPOSITORY
ARG TAG
ARG DATE
ARG VERSION
ARG URL
ARG COMMIT
ARG BRANCH

LABEL org.label-schema.schema-version=&quot;1.0&quot; \
      org.label-schema.build-date=$DATE \
      org.label-schema.name=$REPOSITORY \
      org.label-schema.description=&quot;Computer Vision Backend for Cauchy&quot; \
      org.label-schema.url=https://www.colorai.com/index.php?r=front \
      org.label-schema.vcs-url=$URL \
      org.label-schema.vcs-ref=$COMMIT \
      org.label-schema.vcs-branch=$BRANCH \
      org.label-schema.vendor=$VENDOR \
      org.label-schema.version=$VERSION \
      org.label-schema.docker.cmd=&quot;docker run -d --name framework \
--restart unless-stopped --volume /data:/data --network host --hostname colorai \
--runtime nvidia --shm-size=2g --ulimit memlock=-1 --ulimit stack=67108864 \
$REPOSITORY:$TAG python cauchy_services.py --port 8339&quot;</code></pre>
<p>ARG这一堆的变量是在build镜像时传递过来的, <code>build_docker.sh</code>中的部分代码:</p>
<pre class="shell"><code>docker build --tag $REPOSITORY:$TAG \
             --build-arg REPOSITORY=$REPOSITORY \
             --build-arg TAG=$TAG \
             --build-arg DATE=$DATE \
             --build-arg VERSION=$VERSION \
             --build-arg URL=$URL \
             --build-arg COMMIT=$COMMIT \
             --build-arg BRANCH=$BRANCH \
             .</code></pre>
<p>需要对<strong>org.label-schema.docker.cmd</strong>这个label说明一下, 镜像建立好之后, 需要在该镜像的Container上运行咱们 的框架, 如何运行呢, 不同的框架版本是不是运行的命令和参数不一样, 如果框架版本越来越多, 我如何快速的知道如何 运行指定版本的框架(执行的命令和参数是什么), 当然我们可以通过<strong>org.label-schema.version</strong>和 <strong>org.label-schema.vcs-ref</strong>确定如何执行该container. 为了更简单快捷, 加了一个<strong>org.label-schema.docker.cmd</strong> 参数,它的值表示为<strong>推荐</strong>执行该container的命令, 这里用<strong>推荐</strong>二字, 是因为不是必须的.</p>
<p>建立好镜像后, 如何查看:</p>
<p>command: <code>din 5d3ab89af6d4 --format  '\{\{json .ContainerConfig.Labels\}\}' | python -m json.tool</code></p>
<p>output:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb7-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">    <span class="dt">&quot;com.nvidia.cuda.version&quot;</span><span class="fu">:</span> <span class="st">&quot;9.0.176&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-3" title="3">    <span class="dt">&quot;com.nvidia.cudnn.version&quot;</span><span class="fu">:</span> <span class="st">&quot;7.4.2.24&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-4" title="4">    <span class="dt">&quot;com.nvidia.volumes.needed&quot;</span><span class="fu">:</span> <span class="st">&quot;nvidia_driver&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-5" title="5">    <span class="dt">&quot;maintainer&quot;</span><span class="fu">:</span> <span class="st">&quot;colorai@colorai.com&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="dt">&quot;org.label-schema.build-date&quot;</span><span class="fu">:</span> <span class="st">&quot;2019-08-30T14:46:20Z&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="dt">&quot;org.label-schema.description&quot;</span><span class="fu">:</span> <span class="st">&quot;Computer Vision Backend for Cauchy&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-8" title="8">    <span class="dt">&quot;org.label-schema.docker.cmd&quot;</span><span class="fu">:</span> <span class="st">&quot;docker run -d --name cauchy_service --restart unless-stopped --volume /data:/data --network host --hostname colorai --runtime nvidia --shm-size=2g --ulimit memlock=-1 --ulimit stack=67108864 colorai/cauchycv_visdom:0.2.7 python cauchy_services.py --port 8339&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="dt">&quot;org.label-schema.name&quot;</span><span class="fu">:</span> <span class="st">&quot;colorai/cauchycv_visdom&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="dt">&quot;org.label-schema.schema-version&quot;</span><span class="fu">:</span> <span class="st">&quot;1.0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-11" title="11">    <span class="dt">&quot;org.label-schema.url&quot;</span><span class="fu">:</span> <span class="st">&quot;https://www.colorai.com/index.php?r=front&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-12" title="12">    <span class="dt">&quot;org.label-schema.vcs-branch&quot;</span><span class="fu">:</span> <span class="st">&quot;master&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-13" title="13">    <span class="dt">&quot;org.label-schema.vcs-ref&quot;</span><span class="fu">:</span> <span class="st">&quot;bbe9a6a&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-14" title="14">    <span class="dt">&quot;org.label-schema.vcs-url&quot;</span><span class="fu">:</span> <span class="st">&quot;git@gitee.com:colorai/sig_cauchy_cv.git&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-15" title="15">    <span class="dt">&quot;org.label-schema.vendor&quot;</span><span class="fu">:</span> <span class="st">&quot;ColorAI&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-16" title="16">    <span class="dt">&quot;org.label-schema.version&quot;</span><span class="fu">:</span> <span class="st">&quot;bbe9a6a&quot;</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="fu">}</span></a></code></pre></div>
<p>另外提供了一个<strong>start_docker.sh</strong>脚本用来启动container, 脚本中我会提取出<strong>org.label-schema.docker.cmd</strong>直 接执行.</p>
<p>例如: <code>start_docker.sh</code>中的部分代码:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="va">cmd=$(</span><span class="ex">docker</span> inspect <span class="va">${items[$select]}</span> --format <span class="st">&#39;\{\{index .ContainerConfig.Labels &quot;org.label-schema.docker.cmd&quot;\}\}&#39;</span><span class="va">)</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="kw">if [[</span> x<span class="va">$cmd</span> <span class="ot">!=</span> x<span class="kw"> ]]</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="kw">then</span></a>
<a class="sourceLine" id="cb8-5" title="5">    <span class="va">$cmd</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="kw">else</span></a>
<a class="sourceLine" id="cb8-7" title="7">    <span class="bu">echo</span> <span class="st">&quot;not found command in org.label-schema.docker.cmd&quot;</span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="kw">fi</span></a></code></pre></div>
<p>详细信息可查看<a href="https://gitee.com/colorai/sig_cauchy_cv/blob/master/Dockerfile" target="_blank" rel="noopener">DockerFile</a></p>
<h1 id="简单总结"><span class="header-section-number">4</span> 简单总结</h1>
<ul>
<li><p>创建镜像<a href="https://gitee.com/colorai/sig_cauchy_cv/blob/master/build_docker.sh" target="_blank" rel="noopener"><code>build_docker.sh</code></a></p>
<p>先判断是否已经创建了<code>cauchycv_base</code>(第二层镜像), 如果已经创建了, 直接创建<code>colorai/cauchycv_xxx</code>(第三 层镜像).</p></li>
<li><p>运行镜像<a href="https://gitee.com/colorai/sig_cauchy_cv/blob/master/start_docker.sh" target="_blank" rel="noopener"><code>start_docker.sh</code></a></p>
<p>先获取docker中有多少个Cauchy框架镜像, 如果有多个, 提示选择使用哪个版本, 然后判断该版本的cauchy服务是否 已经启动, 如果已经启动则直接退出, 接着判断是否已经启动了其他版本的cauchy服务, 如果启动了, 停止掉他们, 因为启动的服务现在使用的network为host, 已启动的cauchy服务器已经把端口暂用了, 最后从对应版本的label中获 取到<strong>推荐</strong>用的<strong>org.label-schema.docker.cmd</strong>执行服务器的命令, 直接执行.</p></li>
</ul>
<h1 id="补充"><span class="header-section-number">5</span> 补充</h1>
<p>启动cauchy服务(container)命令参数的介绍:</p>
<pre><code>docker run -d \                              # d: 后台运行
      --name cauchy_service \                # container 名字, 可用于display和filter
      --restart unless-stopped \             # 重启机制: unless-stopped, 只要不是手动停止, 无论服务怎么退出的, 都会重新启动, 即使host系统reboot
      --volume /data:/data \                 # 共享文件, 将host机的/data/映射到container中/data目录
      --network host --hostname colorai \    # 采用host方式的网络, 即使用host机的网络栈, 主机名为colorai
      --runtime nvidia \                     # 运行时状态为GPU容器, GPU程序可以执行
      --shm-size=2g \                        # 共享内存2GB
      --ulimit memlock=-1 \                  # 进程资源限制: 最大锁定内存地址空间，-1表示不限制
      --ulimit stack=67108864 \              # 进程资源限制: 栈最大64MB
      colorai/cauchycv_visdom:0.2.7 \        # 容器运行在哪个镜像里
      python cauchy_services.py --port 8339  # 在容器里执行的程序</code></pre>
<p>共享目录/data,这也是重启容器时不会影响到的目录:</p>
<pre><code>/data
  ├── aicron.sh          # 定时check任务脚本, 由/etc/crontab驱动, 目前只有启动&quot;预置权重http服务&quot;
  ├── checkpoints        # 客户训练模型时checkpoints目录
  ├── datasets           # 常用的数据集
  ├── pretrained_models  # Internet上已经训练好的模型参数
  └── projects           # 客户训练模型时产生的中间文件,如log</code></pre>
<h1 id="附件"><span class="header-section-number">6</span> 附件:</h1>
<ul>
<li><code>build_docker.sh</code></li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1"><span class="co">#!/bin/bash</span></a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="va">base_image=</span>colorai/cauchycv_base</a>
<a class="sourceLine" id="cb11-4" title="4"></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="bu">export</span> <span class="va">LANG=</span><span class="st">&quot;en_US.utf8&quot;</span></a>
<a class="sourceLine" id="cb11-6" title="6"></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="va">DATE=$(</span><span class="fu">date</span> -u +<span class="st">&#39;%Y-%m-%dT%H:%M:%SZ&#39;</span><span class="va">)</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="va">VERSION=$(</span><span class="fu">git</span> describe --tags --always<span class="va">)</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="va">URL=$(</span><span class="fu">git</span> config --get remote.origin.url<span class="va">)</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="va">COMMIT=$(</span><span class="fu">git</span> rev-parse HEAD <span class="kw">|</span> <span class="fu">cut</span> -c 1-7<span class="va">)</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="va">BRANCH=$(</span><span class="fu">git</span> rev-parse --abbrev-ref HEAD<span class="va">)</span></a>
<a class="sourceLine" id="cb11-12" title="12"></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="va">REPOSITORY=</span><span class="st">&quot;colorai/cauchycv_visdom&quot;</span></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="va">TAG=</span><span class="st">&quot;0.2.</span><span class="va">$(</span><span class="fu">git</span> rev-list HEAD <span class="kw">|</span> <span class="fu">wc</span> -l <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1}&#39;</span><span class="va">)</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb11-15" title="15"></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="bu">echo</span> <span class="st">&quot;DATE: </span><span class="va">$DATE</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="bu">echo</span> <span class="st">&quot;VERSION: </span><span class="va">$VERSION</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="bu">echo</span> <span class="st">&quot;URL: </span><span class="va">$URL</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb11-19" title="19"><span class="bu">echo</span> <span class="st">&quot;COMMIT: </span><span class="va">$COMMIT</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb11-20" title="20"><span class="bu">echo</span> <span class="st">&quot;BRANCH: </span><span class="va">$BRANCH</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb11-21" title="21"><span class="bu">echo</span> <span class="st">&quot;IMAGE: </span><span class="va">$REPOSITORY</span><span class="st">:</span><span class="va">$TAG</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb11-22" title="22"></a>
<a class="sourceLine" id="cb11-23" title="23"><span class="kw">if</span><span class="bu"> [</span> <span class="ot">!</span> <span class="ot">-d</span> external<span class="bu"> ]</span></a>
<a class="sourceLine" id="cb11-24" title="24"><span class="kw">then</span></a>
<a class="sourceLine" id="cb11-25" title="25">    <span class="fu">git</span> clone git@gitee.com:colorai/sig_cauchy_external.git external</a>
<a class="sourceLine" id="cb11-26" title="26"><span class="kw">fi</span></a>
<a class="sourceLine" id="cb11-27" title="27"></a>
<a class="sourceLine" id="cb11-28" title="28"><span class="va">base_tag=</span><span class="kw">`</span><span class="ex">docker</span> images -q <span class="va">$base_image</span>:latest<span class="kw">`</span></a>
<a class="sourceLine" id="cb11-29" title="29"></a>
<a class="sourceLine" id="cb11-30" title="30"><span class="kw">if [[</span> x<span class="va">$base_tag</span> <span class="ot">==</span> x<span class="kw"> ]]</span></a>
<a class="sourceLine" id="cb11-31" title="31"><span class="kw">then</span></a>
<a class="sourceLine" id="cb11-32" title="32">     <span class="bu">echo</span> <span class="st">&quot;build </span><span class="va">$base_image</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb11-33" title="33">     <span class="ex">docker</span> build --tag <span class="va">$base_image</span>:latest \</a>
<a class="sourceLine" id="cb11-34" title="34">                  --build-arg DATE=<span class="va">$DATE</span> \</a>
<a class="sourceLine" id="cb11-35" title="35">                  --file Dockerfile.base .</a>
<a class="sourceLine" id="cb11-36" title="36"><span class="kw">fi</span></a>
<a class="sourceLine" id="cb11-37" title="37"></a>
<a class="sourceLine" id="cb11-38" title="38"><span class="ex">docker</span> build --tag <span class="va">$REPOSITORY</span>:<span class="va">$TAG</span> \</a>
<a class="sourceLine" id="cb11-39" title="39">             --build-arg REPOSITORY=<span class="va">$REPOSITORY</span> \</a>
<a class="sourceLine" id="cb11-40" title="40">             --build-arg TAG=<span class="va">$TAG</span> \</a>
<a class="sourceLine" id="cb11-41" title="41">             --build-arg DATE=<span class="va">$DATE</span> \</a>
<a class="sourceLine" id="cb11-42" title="42">             --build-arg VERSION=<span class="va">$VERSION</span> \</a>
<a class="sourceLine" id="cb11-43" title="43">             --build-arg URL=<span class="va">$URL</span> \</a>
<a class="sourceLine" id="cb11-44" title="44">             --build-arg COMMIT=<span class="va">$COMMIT</span> \</a>
<a class="sourceLine" id="cb11-45" title="45">             --build-arg BRANCH=<span class="va">$BRANCH</span> \</a></code></pre></div>
<ul>
<li><code>start_docker.sh</code></li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1"><span class="co">#!/bin/bash</span></a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="va">items=($(</span><span class="ex">docker</span> images --filter <span class="st">&quot;label=org.label-schema.vendor=ColorAI&quot;</span> --format <span class="st">&quot;\{\{.Repository\}\}:\{\{.Tag\}\}&quot;</span><span class="va">))</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="va">count=</span>$<span class="dt">\{</span>\#<span class="ex">items</span>[@]}</a>
<a class="sourceLine" id="cb12-5" title="5"></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="kw">if</span> <span class="kw">((</span> <span class="va">$count</span> == 0 <span class="kw">))</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="kw">then</span></a>
<a class="sourceLine" id="cb12-8" title="8">    <span class="bu">echo</span> <span class="st">&quot;not found correct image!&quot;</span></a>
<a class="sourceLine" id="cb12-9" title="9">    <span class="bu">exit</span> 0</a>
<a class="sourceLine" id="cb12-10" title="10"><span class="kw">fi</span></a>
<a class="sourceLine" id="cb12-11" title="11"></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="kw">if</span> <span class="kw">((</span> <span class="va">$count</span> &gt; 1 <span class="kw">))</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="kw">then</span></a>
<a class="sourceLine" id="cb12-14" title="14">    <span class="va">i=</span>0</a>
<a class="sourceLine" id="cb12-15" title="15">    <span class="kw">while</span> <span class="kw">((</span> i &lt; <span class="va">$count</span> <span class="kw">))</span></a>
<a class="sourceLine" id="cb12-16" title="16">    <span class="kw">do</span></a>
<a class="sourceLine" id="cb12-17" title="17">        <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$i</span><span class="st">. </span><span class="va">${items[$i]}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb12-18" title="18">        <span class="kw">((</span> i = i + 1 <span class="kw">))</span></a>
<a class="sourceLine" id="cb12-19" title="19">    <span class="kw">done</span></a>
<a class="sourceLine" id="cb12-20" title="20">    <span class="bu">echo</span> -n <span class="st">&quot;Select: &quot;</span></a>
<a class="sourceLine" id="cb12-21" title="21">    <span class="bu">read</span> <span class="va">select</span></a>
<a class="sourceLine" id="cb12-22" title="22"><span class="kw">else</span></a>
<a class="sourceLine" id="cb12-23" title="23">    <span class="va">select=</span>0</a>
<a class="sourceLine" id="cb12-24" title="24"><span class="kw">fi</span></a>
<a class="sourceLine" id="cb12-25" title="25"></a>
<a class="sourceLine" id="cb12-26" title="26"><span class="bu">echo</span> <span class="st">&quot;use image: </span><span class="va">${items[$select]}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb12-27" title="27"></a>
<a class="sourceLine" id="cb12-28" title="28"><span class="va">container=</span><span class="kw">`</span><span class="ex">docker</span> container  ls --filter ancestor=<span class="va">${items[$select]}</span> --filter status=running -q<span class="kw">`</span></a>
<a class="sourceLine" id="cb12-29" title="29"></a>
<a class="sourceLine" id="cb12-30" title="30"><span class="kw">if [[</span> x<span class="va">$container</span> <span class="ot">!=</span> x<span class="kw"> ]]</span></a>
<a class="sourceLine" id="cb12-31" title="31"><span class="kw">then</span></a>
<a class="sourceLine" id="cb12-32" title="32">    <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">${items[$select]}</span><span class="st">: </span><span class="va">$container</span><span class="st"> already start, you can stop/remove it before start&quot;</span></a>
<a class="sourceLine" id="cb12-33" title="33">    <span class="bu">exit</span> 0</a>
<a class="sourceLine" id="cb12-34" title="34"><span class="kw">fi</span></a>
<a class="sourceLine" id="cb12-35" title="35"></a>
<a class="sourceLine" id="cb12-36" title="36"><span class="va">containers=(</span><span class="kw">`</span><span class="ex">docker</span> container  ls --filter name=cauchy_service --filter status=running -q<span class="kw">`</span><span class="va">)</span></a>
<a class="sourceLine" id="cb12-37" title="37"></a>
<a class="sourceLine" id="cb12-38" title="38"><span class="kw">for</span> <span class="ex">c</span> in <span class="va">$containers</span></a>
<a class="sourceLine" id="cb12-39" title="39"><span class="kw">do</span></a>
<a class="sourceLine" id="cb12-40" title="40">    <span class="bu">echo</span> <span class="st">&quot;stop </span><span class="va">$c</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb12-41" title="41">    <span class="ex">docker</span> container stop <span class="va">$c</span></a>
<a class="sourceLine" id="cb12-42" title="42"><span class="kw">done</span></a>
<a class="sourceLine" id="cb12-43" title="43"></a>
<a class="sourceLine" id="cb12-44" title="44"><span class="ex">docker</span> inspect <span class="va">${items[$select]}</span> --format  <span class="st">&#39;\{\{json .ContainerConfig.Labels\}\}&#39;</span> <span class="kw">|</span> <span class="ex">python</span> -m json.tool</a>
<a class="sourceLine" id="cb12-45" title="45"></a>
<a class="sourceLine" id="cb12-46" title="46"><span class="va">cmd=$(</span><span class="ex">docker</span> inspect <span class="va">${items[$select]}</span> --format <span class="st">&#39;\{\{index .ContainerConfig.Labels &quot;org.label-schema.docker.cmd&quot;\}\}&#39;</span><span class="va">)</span></a>
<a class="sourceLine" id="cb12-47" title="47"></a>
<a class="sourceLine" id="cb12-48" title="48"><span class="kw">if [[</span> x<span class="va">$cmd</span> <span class="ot">!=</span> x<span class="kw"> ]]</span></a>
<a class="sourceLine" id="cb12-49" title="49"><span class="kw">then</span></a>
<a class="sourceLine" id="cb12-50" title="50">    <span class="va">$cmd</span></a>
<a class="sourceLine" id="cb12-51" title="51"><span class="kw">else</span></a>
<a class="sourceLine" id="cb12-52" title="52">    <span class="bu">echo</span> <span class="st">&quot;not found command in org.label-schema.docker.cmd&quot;</span></a>
<a class="sourceLine" id="cb12-53" title="53"><span class="kw">fi</span></a></code></pre></div>
</body>
</html>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-09-16T12:56:11.909Z" itemprop="dateUpdated">2019-09-16 20:56:11</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://qrsforever.github.io">
            <img src="/img/avatar.jpg" alt="qrsforever">
            qrsforever
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cauchy/">Cauchy</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://qrsforever.github.io/2019/08/31/Company/Cauthy/how_run/&title=《框架运行docker设计》 — 大地小神&pic=https://qrsforever.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://qrsforever.github.io/2019/08/31/Company/Cauthy/how_run/&title=《框架运行docker设计》 — 大地小神&source=


  
  
  
  dummy
  
      code{white-space: pre-wrap;}
      span.smallcap..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://qrsforever.github.io/2019/08/31/Company/Cauthy/how_run/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《框架运行docker设计》 — 大地小神&url=https://qrsforever.github.io/2019/08/31/Company/Cauthy/how_run/&via=https://qrsforever.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://qrsforever.github.io/2019/08/31/Company/Cauthy/how_run/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2019/09/03/Note/AI/visdom/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Visdom原理</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2019/08/28/Tutorial/docker/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Dorcker</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <!-- <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script> -->
    <script src="/js/av-min.js"></script>
    <script src="/js/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'false' == 'true',
            verify: 'false' == 'true',
            appId: "bpShGWdW8DpODhnDko5O2IBB-gzGzoHsz",
            appKey: "rwmasTllBbHE69ADuLjFyFWf",
            avatar: "mm",
            placeholder: "Just go go",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->










</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢打赏!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>qrsforever &copy; 2017 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://qrsforever.github.io/2019/08/31/Company/Cauthy/how_run/&title=《框架运行docker设计》 — 大地小神&pic=https://qrsforever.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://qrsforever.github.io/2019/08/31/Company/Cauthy/how_run/&title=《框架运行docker设计》 — 大地小神&source=


  
  
  
  dummy
  
      code{white-space: pre-wrap;}
      span.smallcap..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://qrsforever.github.io/2019/08/31/Company/Cauthy/how_run/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《框架运行docker设计》 — 大地小神&url=https://qrsforever.github.io/2019/08/31/Company/Cauthy/how_run/&via=https://qrsforever.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://qrsforever.github.io/2019/08/31/Company/Cauthy/how_run/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://qrsforever.github.io/2019/08/31/Company/Cauthy/how_run/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>










<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!-- lidong cha. -->
<!-- <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<!-- lidong end. -->

</body>
</html>
